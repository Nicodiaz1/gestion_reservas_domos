<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Domos - Sistema de Reservas</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <header>
        <div class="container">
            <h1>üèïÔ∏è DOMOS GLAMPING</h1>
            <p>Reserva tu experiencia de lujo en la naturaleza</p>
        </div>
    </header>

    <main class="container">
        <section id="domosContainer" class="domos-grid">
            <p style="text-align: center; grid-column: 1/-1; padding: 40px; color: #999;">Cargando domos...</p>
        </section>
    </main>

    <!-- Modal de Reserva -->
    <div id="reservaModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Reservar tu Domo</h2>
                <button class="close">&times;</button>
            </div>
            
            <form id="reservaForm">
                <div class="form-group">
                    <label>Domo Seleccionado:</label>
                    <input type="text" id="domoNombre" readonly style="background: #f5f5f5;">
                    <input type="hidden" id="domoId">
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div class="form-group">
                        <label>Fecha de Entrada:</label>
                        <input type="date" id="fechaInicio" required>
                    </div>

                    <div class="form-group">
                        <label>Fecha de Salida:</label>
                        <input type="date" id="fechaFin" required>
                    </div>
                </div>

                <div class="price-section" id="precioSection" style="display: none;">
                    <div class="price-row">
                        <span class="price-label">Noches:</span>
                        <span id="noches">0</span>
                    </div>
                    <div class="price-row">
                        <span class="price-label">Precio Base:</span>
                        <span id="precioBase">$0</span>
                    </div>
                    <div class="price-row" id="descuentoRow" style="display: none;">
                        <span class="price-label">Descuento:</span>
                        <span id="descuento" style="color: #4caf50;">-$0</span>
                    </div>
                    <div class="price-row" style="border-top: 2px solid #ddd; padding-top: 12px; margin-top: 12px;">
                        <span class="price-label" style="font-weight: 700; font-size: 16px;">Total:</span>
                        <span id="precioTotal" style="font-weight: 700; font-size: 18px;">$0</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>Tu Nombre:</label>
                    <input type="text" id="nombreCliente" required placeholder="Juan P√©rez">
                </div>

                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="emailCliente" required placeholder="correo@ejemplo.com">
                </div>

                <div class="form-group">
                    <label>Tel√©fono:</label>
                    <input type="tel" id="telefonoCliente" required placeholder="+34 123 456 789">
                </div>

                <button type="submit" class="btn" style="margin-top: 20px;">Confirmar Reserva</button>
            </form>
        </div>
    </div>

    <!-- Modal de √âxito -->
    <div id="successModal" class="modal">
        <div class="modal-content" style="text-align: center;">
            <h2 style="color: #4caf50; margin-bottom: 20px;">‚úì ¬°Reserva Confirmada!</h2>
            <p id="successMessage" style="margin-bottom: 30px; font-size: 15px; line-height: 1.8;"></p>
            <button onclick="location.reload()" class="btn">Cerrar</button>
        </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>

                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="emailCliente">
                </div>

                <div class="form-group">
                    <label>Tel√©fono:</label>
                    <input type="tel" id="telefonoCliente">
                </div>

                <div id="precioInfo" class="precio-info">
                    <p>Selecciona fechas para ver el precio</p>
                </div>

                <button type="submit" class="btn btn-primary">Confirmar Reserva</button>
            </form>
        </div>
    </div>

    <script>
        let domos = [];
        let precioActual = null;

        // Cargar domos
        async function cargarDomos() {
            try {
                const res = await fetch('/api/domos');
                domos = await res.json();
                mostrarDomos();
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('domosContainer').innerHTML = '<p>Error al cargar domos</p>';
            }
        }

        function mostrarDomos() {
            const container = document.getElementById('domosContainer');
            container.innerHTML = domos.map(domo => `
                <div class="domo-card">
                    <h3>${domo.nombre}</h3>
                    <p>${domo.descripcion}</p>
                    <p class="capacidad">üë• Capacidad: ${domo.capacidad} personas</p>
                    <button class="btn btn-primary" onclick="abrirReserva(${domo.id}, '${domo.nombre}')">Reservar</button>
                </div>
            `).join('');
        }

        function abrirReserva(domoId, domoNombre) {
            document.getElementById('domoId').value = domoId;
            document.getElementById('domoNombre').value = domoNombre;
            document.getElementById('fechaInicio').value = '';
            document.getElementById('fechaFin').value = '';
            document.getElementById('nombreCliente').value = '';
            document.getElementById('emailCliente').value = '';
            document.getElementById('telefonoCliente').value = '';
            document.getElementById('precioInfo').innerHTML = '<p>Selecciona fechas para ver el precio</p>';
            document.getElementById('reservaModal').style.display = 'block';
        }

        // Calcular precio cuando cambian las fechas
        document.getElementById('fechaInicio').addEventListener('change', calcularPrecio);
        document.getElementById('fechaFin').addEventListener('change', calcularPrecio);

        async function calcularPrecio() {
            const fechaInicio = document.getElementById('fechaInicio').value;
            const fechaFin = document.getElementById('fechaFin').value;
            const domoId = document.getElementById('domoId').value;

            if (!fechaInicio || !fechaFin || !domoId) return;

            try {
                const res = await fetch('/api/calcular-precio', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        domo_id: domoId,
                        fecha_inicio: fechaInicio,
                        fecha_fin: fechaFin
                    })
                });

                const data = await res.json();
                if (data.error) {
                    document.getElementById('precioInfo').innerHTML = `<p class="error">${data.error}</p>`;
                    return;
                }

                precioActual = data.total;
                document.getElementById('precioInfo').innerHTML = `
                    <div class="precio-desglose">
                        <p>D√≠as: ${data.dias}</p>
                        <p>Subtotal: $${data.subtotal}</p>
                        ${data.descuento > 0 ? `<p>Descuento (${data.porcentaje_descuento}%): -$${data.descuento}</p>` : ''}
                        <p class="total"><strong>Total: $${data.total}</strong></p>
                    </div>
                `;
            } catch (error) {
                console.error('Error:', error);
            }
        }

        // Enviar reserva
        document.getElementById('reservaForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const reserva = {
                domo_id: parseInt(document.getElementById('domoId').value),
                nombre: document.getElementById('nombreCliente').value,
                email: document.getElementById('emailCliente').value,
                telefono: document.getElementById('telefonoCliente').value,
                fecha_inicio: document.getElementById('fechaInicio').value,
                fecha_fin: document.getElementById('fechaFin').value,
                precio_total: precioActual
            };

            try {
                const res = await fetch('/api/crear-reserva', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(reserva)
                });

                const data = await res.json();
                if (data.success) {
                    alert('¬°Reserva confirmada! ID: ' + data.reserva_id);
                    document.getElementById('reservaModal').style.display = 'none';
                } else {
                    alert('Error: ' + data.error);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error al crear la reserva');
            }
        });

        // Cerrar modal
        document.querySelector('.close').onclick = () => {
            document.getElementById('reservaModal').style.display = 'none';
        };

        window.onclick = (event) => {
            const modal = document.getElementById('reservaModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        };

        // Cargar al iniciar
        cargarDomos();
    </script>
</body>
</html>
